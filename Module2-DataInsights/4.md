# Module 2: Data Insights

# Exercise 4:	Implement IoT remote Monitoring and Notifications 

Duration: 45 mins

## Scenario

Contoso wants to make sure that the vaccine is not exposed to unstable temperatures as that will result in irreversible damage to the vaccines. So, Contoso requires a way to monitor the temperature data generated by the built-in sensors and evaluate if the vaccine needs to be replaced in case the temperature goes above 30°C/86°F. Contoso wants an order to be placed automatically to replace the damaged vaccine in case the measured temperature goes above 30°C/86°F.

To achieve these requirements, you will be configuring a route in the Azure IoT Hub to direct the messages to the service bus queue as soon as the temperature reaches 30°C/86°F or more. Then you will configure a Logic App to be triggered by a Service Bus queue whenever a message is added to the queue and automatically creates a sales order in the SAP system.

## Overview

In this exercise, you will create a message routing rule to direct messages that contain a temperature alert to the Service Bus queue. Then, you will set up a Logic App to monitor the Service Bus queue and place an order automatically in the SAP system to replace the damaged vaccine whenever a message is added to the queue.

This exercise includes the following tasks:

* Review the Service Bus queue and add a Shared access policy to the Service Bus namespace. 
* Add a custom endpoint and routing rule to the Azure IoT hub.
* Configure the Logic App trigger to create a SAP Sales order via OData.
* Run the Raspberry Pi Simulator 
* Run the Logic App and review the Logic App run. 

 > `Microsoft Azure Service Bus` is a fully managed enterprise message broker with message queues and publish-subscribe topics. To use Service Bus messaging entities in Azure, a namespace with a name that is unique across Azure needs to be created.
    
 > `Service Bus Namespace` - A namespace is a container for all messaging components. Multiple queues and topics can be in a single namespace, and namespaces often serve as application containers. A namespace provides a scoping container for addressing Service Bus resources.
    
 > `Service Bus Queue` - Messages are sent to and received from queues. Queues store messages until the receiving application is available to receive and process them. Messages in queues are ordered and timestamped on arrival.

   > You can find more information about Microsoft Azure Service Bus here: `https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-messaging-overview`

## Task 1: Review the Service Bus queue and add a Shared access policy to the namespace. 

In this task, you will review the existing Service Bus namespace and Service Bus queue then add a Shared access policy to the queue which allows the queue to send and listen to the requests.

1. Navigate back to the browser tab in which Azure Portal is open and select aiw-sap-<inject key="DeploymentID" enableCopy="false" /> resource group then service bus named iotservicebus-<inject key="DeploymentID" enableCopy="false" /> .

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-servicebus.png?raw=true)

1. Select **Queues (1)** under *Entities* from the left-hand side menu and select the **sb-queue (2)** queue from the list.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-servicebusqueue-1.png?raw=true)

1. On the **sb-queue** blade, select **Shared access policies** from the left-hand side menu.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-servicebusqueue-2.png?raw=true)
   
1. Click on **+ Add** to add the policy.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-servicebusqueue-4.png?raw=true)

1. On the **Add SAS Policy** blade, enter the following information:

     1. Policy name: Enter the below value in the policy name field.
	
	```
	sb-queue-policy
	```
	
     1. Check **Manage**  
     1. Select **Create** to create the policy.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-servicebusqueue-3.png?raw=true)
   
## Task 2: Add a custom endpoint and routing rule to the Azure IoT hub. 

In this task, you will add a custom endpoint for the Service Bus queue to your IoT hub and create a message routing rule which directs the messages containing a temperature alert to the Service Bus queue.

The routing rule uses a routing query, temperatureAlert = "true", to forward messages based on the value of the temperatureAlert application property set by the client code running on the device.

### Task 2.1: Add a custom endpoint

   > An IoT hub has a default built-in endpoint. You can create custom endpoints to route messages to other services available in the subscription by linking them to Azure IoT Hub. IoT Hub currently supports Azure Storage containers, Event Hubs, Service Bus Queues, and Service Bus topics as custom endpoints.

1. Navigate to aiw-sap-<inject key="DeploymentID" enableCopy="false" /> resource group and select the iothub named iothub-<inject key="DeploymentID" enableCopy="false" />.

1. From the left-hand side menu, select **Message routing** under **Messaging**. 

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-customendpoint.png?raw=true)

1. On the Message routing pane, select the **Custom endpoints** tab.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-customendpoint-1.1.png?raw=true)

1. Now, select **+ Add (1)** to create an endpoint. From the drop-down list, select **Service bus queue (2)**.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-customendpoint-1.png?raw=true)

1. On the **Add a service bus endpoint** pane, enter the following information:

     1. **Endpoint name**: Enter the below value in the endpoint name field.
	
	```
	sb-endpoint
	```

     2. **Service bus namespace**: Select **iotservicebus-<inject key="DeploymentID" enableCopy="false" />** from the dropdown

     3. **Service bus queue**: Select **sb-queue** from the dropdown

        ![Add an endpoint to your IoT hub in the Azure portal](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-customenpoint-2.png?raw=true)

1. Select **Create** to create the endpoint. 

   ![Add an endpoint to your IoT hub in the Azure portal](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-customenpoint-2.1.png?raw=true)

1. After the endpoint is created successfully, the endpoint will be listed under **Service Bus queue** on the **Custom endpoints** tab.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-customenpoint-3.png?raw=true)

### Task 2.2: Add a routing rule

  > Routing provides a querying capability to filter the data before routing it to the Custom endpoints.

1. Back on the **Message routing** pane of IoT Hub, select the **Routes (1)** tab and then select **+ Add (2)**.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-messageroute-1.png?raw=true) 

1. On the **Add a route** pane, enter the following information:

     1. **Name**: Enter the below value in the name field.
     
	```
	iot-sb-route-1
	```

     2. **Endpoint**: Select the endpoint **sb-endpoint** which you created in the previous task from the dropdown.

     3. **Data source**: Select **Device Telemetry Messages**.
   
     4. **Enable route** : Select **Enable**

     5. **Routing query**: Enter the below query

     
	```
	temperatureAlert = "true"
	```

     6. Select **Save** to add the routing rule which will send messages containing the temperature alert to the Service Bus queue and close the **Message routing** pane.

        ![Add a routing rule in the Azure portal](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-messageroute-2.png?raw=true)
   
1. After the route is created successfully, it will be listed under the **Routes** tab.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-messageroute-3.png?raw=true)
   
   
## Task 3: Configure the Logic App trigger to create a SAP Sales order via OData 

Logic Apps is a cloud-based platform that helps you create and run automated workflows for integrating apps, data, services, and systems. Using this platform, you can more easily and quickly build highly scalable integration solutions for enterprise and business-to-business (B2B) scenarios. You can find more references about Logic App from here: `https://docs.microsoft.com/en-us/azure/logic-apps`

In this task, you will configure a Logic App to be triggered by a Service Bus queue and create a SAP Sales order via OData whenever a message is added to the Service Bus queue. The data will be sent to the Service Bus queue from IoT Hub if the temperature of the devices exceeds a certain value (30°C/86°F).

1. Navigate back to the aiw-sap-<inject key="DeploymentID" enableCopy="false" /> resource group and select the Logic App named sap-logicapp-<inject key="DeploymentID" enableCopy="false" />.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-1.png?raw=true)

1. When you select the Logic App, the Logic Apps Designer opens. Scroll down to **Templates** and select **Blank Logic App**.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-2.png?raw=true)

1. On the **Add a trigger** pane, select the **All (1)** tab and then select **Service Bus (2)**.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-3.1.png?raw=true)

1. Under **Triggers**, select **When one or more messages arrive in a queue (auto-complete)**.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-4.png?raw=true)

   > Follow the below steps to create a service bus connection.

1. Enter the below value for **connection name** **(1)** and select your **Service Bus namespace (2)** from the list.
     
   ```
   sb-connection
   ```
	
   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-5.1.png?raw=true)

1. Now, select the service bus policy (RootManageSharedAccessKey). 

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-6.1.png?raw=true)
      
1. Then, select **Create** to create the connection.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-7.1.png?raw=true)

1. On the final screen, enter the following informaion:
      
      1. **Queue name**: Select **sb-queue** from the drop-down that you created earlier. 
      2. **Maximum message count** : Enter the value `175`.
 
   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-8.1.png?raw=true)

1. Now, click on Collapse button to close the **When one or more messages arrive in a queue (auto-complete)** trigger pane.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/Ex4-logicapp-001.png?raw=true)

1. Select **Save** on the menu at the top of the Logic Apps Designer to save your changes.

1. Click on **+ (1)** and select **Add an action (2)** to add a new action. 

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-8.2.png?raw=true)

1. Now, under **Add an action**, select the **All** tab.

1. Select **HTTP** from the list.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-9.1.png?raw=true)

1. Under **Actions**, select **HTTP** again.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-10.2.png?raw=true)

1. Click inside the name box, and replace the existing name **HTTP** with the below name and select anywhere in the Logic App designer to save the name.

   ```
   http_get_request
   ```
   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-10.3.png?raw=true)
  
   > After replacing the name, your screen will look like below screenshot.

    ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-10.4.png?raw=true)
   
   > In the following steps, you will configure the **http_get_request** action to login to the SAP Gateway system and fetch the appropriate token for use in the next action.

1. Under **Method**, select **GET** from the dropdown.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-p2-logicapp-45.1.png?raw=true)

   > **Note**: 
   
      1. If you have any difficulties with the **Dynamic content list** tab while configuring the action, you can click on the **Split Window** button in the bottom right corner to open the Lab Guide in a new window.
   
         ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M3-Ex3-powerautomate-3.png?raw=true)
      
      2. You can get the Lab Guide back in the environment by clicking on the **Join Windows** button in the bottom right corner.

         ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M3-Ex3-powerautomate-4.png?raw=true)
       
1. Now, enter the below value in the URI field.

   ```
   https://sapes5.sapdevcenter.com/sap/opu/odata/iwbep/GWSAMPLE_BASIC/SalesOrderSet/
   ```
   
1. Next, enter the following Header parameters:

     1. Connection: keep-alive
     
         Perform the below steps to add the parameter.
           1. Enter the below value under Key field.
              ```
              Connection
              ```
           2. Enter the below value under **Value** field.
              ```
              keep-alive
              ```

     2. X-CSRF-Token: fetch
     
         Perform the below steps to add the parameter.
           1. Enter the below value under Key field.
              ```
              X-CSRF-Token
              ```
           2. Enter the below value under **Value** field.
              ```
              fetch
              ```
  
1. After adding all the parameters, the final screenshot will look like this:

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-12.png?raw=true)

1. Now, scroll down and select **Add New Parameter** to add a new parameter.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-12.1.png?raw=true)
   
1. Select **Authentication** parameter from the dropdown.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-13.2.png?raw=true)

1. Under Authentication, enter the following information:

     - **Authentication type** : Select **Basic** from the dropdown.
     - **Username** : Enter the username of Es5 demo account which you noted earlier.
     - **Password** : Enter the password of the ES5 demo account: <inject key="AzureAdUserPassword"></inject>
      
   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-14.png?raw=true)
   
    > **Note**: If you have used a different password while creating the demo ES5 account, you can use that password. You can enter the above password if you have followed the instructions given in the lab guide.

1. After adding all the values, the final screenshot will look like this:

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-15.1.png?raw=true)

1. Now, click on Collapse button to close the **HTTP** action pane.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/Ex4-logicapp-002.png?raw=true)

1. Select **Save** on the menu at the top of the Logic Apps Designer to save your changes.

1. Click on **+ (1)** and select **Add an action (2)** to add a new action. 

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-15.3.png?raw=true)

1. Now, under **Add an action**, select the **All** tab.

1. Select **HTTP** from the list.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-9.1.png?raw=true)

1. Under **Actions**, select **HTTP** again.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-10.2.png?raw=true)

1. Click inside the name box, and replace the existing name **HTTP** with the below name and select anywhere in the Logic App designer to save the name.

   ```
   http_post_request
   ```
   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-10.3.png?raw=true)
  
   > After replacing the name, your screen will look like below screenshot.

    ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-10.5.png?raw=true)
    
   > You will be configuring the **http_post_request** action in the following steps to add a new sales order to the SAP system. You will hardcode the values of the sales order in this case; however, you can also pass the dynamic values for sales order details, which you will be doing in the 6th exercise.

1. Under **Method**, select **POST** from the dropdown.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-p2-logicapp-46.1.png?raw=true)

1. Now, enter the below value in the URI field.

   ```
   https://sapes5.sapdevcenter.com/sap/opu/odata/iwbep/GWSAMPLE_BASIC/SalesOrderSet/
   ```
   
1. Next, enter the following Header parameters:

     1. Connection: keep-alive
     
         Perform the below steps to add the parameter.
           1. Enter the below value under Key field.
              ```
              Connection
              ```
           2. Enter the below value under **Value** field.
              ```
              keep-alive
              ```

     2. X-Requested-With : XMLHttpRequest
     
         Perform the below steps to add the parameter.
           1. Enter the below value under Key field.
              ```
              X-Requested-With
              ```
           2. Enter the below value under **Value** field.
              ```
              XMLHttpRequest
              ```
	      
     3. X-CSRF-Token: outputs(‘http_get_request)['headers']['x-csrf-token']
       
        To add **X-CSRF-Token** header parameter, follow the below steps:
	 
         1. Enter the below value in the **Enter Key** field.
            ```
            X-CSRF-Token
            ```
         2. Click inside  **Enter value** box so that the dynamic content list appears on the right of the designer.
         3. Select **expression** tab on the **Add dynamic content** window which appears on the right side of the designer.
         4. Enter the below value in the expression box.
	    
	    ```
	    outputs('http_get_request')['headers']['x-csrf-token']
	    ```

	      ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-17.2.png?raw=true)

         5. Click on **OK**.
         
1. After adding all the header parameters, your screen will look like below screenshot:
         
   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-18.1.png?raw=true)
   
1. Under **Body** field, paste the following content.
    

        {
		       "BillingStatus": "",
                        "BillingStatusDescription": "Initial",
                        "ChangedAt": "2014-10-10T00:00:00",
                        "CreatedAt": "2012-10-10T00:00:00",
                        "CurrencyCode": "EUR",
                        "CustomerID": "0100000000",
                        "CustomerName": "SAP",
                        "DeliveryStatus": null,
                        "DeliveryStatusDescription": "Initial",
                        "GrossAmount": "2000",
                        "LifecycleStatus": "N",
                        "LifecycleStatusDescription": "New",
                        "NetAmount": "100",
                        "Note": "SAP and Azure in Berlin",
                        "NoteLanguage": "E",
                        "SalesOrderID": "0500000011",
                        "TaxAmount": "200"
			}

      
1. After adding the content, your screen will look like the below screenshot:
       
   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-19.png?raw=true)

1. To add an expression as a value under the **Cookie** field, follow the below steps:
      
      1. Click inside  **Enter Http cookie** box so that the dynamic content list appears on the right of the designer.
      2. select **expression** tab on the **Add dynamic content** window which appears on the right side of the designer.
      3. Enter the below value in the expression box.
      	    
	  ```
	  replace(outputs('http_get_request')['headers']['Set-cookie'], ',', ';')
	  ```

	  ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-21.1.png?raw=true)

      4. Click on **OK**.
         
1. After adding all the values, the final screenshot will look like this:
     
   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-22.1.png?raw=true)

1. Now, click on Collapse button to close the **HTTP** action pane.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/Ex4-logicapp-003.png?raw=true)

1. Select **Save** on the menu at the top of the Logic Apps Designer to save your changes.

## Task 4: Start resending data from the Simulator 

In this task, you will run the Raspberry Pi online simulator and view the sensor data that is being sent to IoT Hub by the Azure IoT Hub device. 

1. Navigate back to the browser tab in which the Raspberry Pi online simulator was open, you can also launch it using the below URL.

   ```
   https://azure-samples.github.io/raspberry-pi-web-simulator/#GetStarted
   ```

1. Select Run or type npm start to run the application.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex2-simulator-3.png?raw=true)

1. You should see the following output that shows the sensor data and the messages that are sent to your IoT hub.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex2-simulator-4.png?raw=true)
   
## Task 5: Run the Logic App and review the Logic App run. 

In this task, you will run the Logic App and review the Logic App run.

1. Navigate back to the aiw-sap-<inject key="DeploymentID" enableCopy="false" /> resource group and select the **Logic App** named sap-logicapp-<inject key="DeploymentID" enableCopy="false" />. 

1. Select **Logic app designer** under **Development Tools** from the left-hand side menu.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-23.1.png?raw=true)
   
1. On the **Logic app designer** blade, click on **Run Trigger** and then select **Run** to run the workflow.  

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-23.4.png?raw=true)
   
1. Once you click on **Run**, the Logic App will be triggered for new data.

   > Info: Every time you trigger the Logic App, all the triggers and actions are executed and a sales order is added to the SAP system.

1. Now, select **Overview (1)** from the left-hand side menu then scroll down and select **Run history (2)** tab.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-24.png?raw=true)

1. Select the most recent run and review the Logic App run details then, minimize the Azure Portal window.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-25.1.png?raw=true)
   
   > **Note**: If you are not able to see the Logic App run under **Run history**, click on **Refresh** on the **Overview** pane toolbar to fetch the recent results.
   
     ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-23.3.png?raw=true)
     
   > Since, you are done with this exercise, you will go ahead and disable the Logic App in the following steps.

1. Navigate back to the sap-logicapp-<inject key="DeploymentID" enableCopy="false" /> and select **Overview** from the left-hand side menu.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-26.png?raw=true)

1. On the **Overview** pane toolbar, click on **Disable** to disable the Logic App.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex4-logicapp-27.png?raw=true)
   
1. Navigate back to the browser tab in which the Raspberry Pi online simulator is open and click on **Stop** to stop sending the data to IoT Hub.

   ![](https://github.com/CloudLabsAI-Azure/AIW-SAP-on-Azure/blob/main/media/M2-Ex3-simulator-5.png?raw=true)
   
   
## Summary

In this exercise, you have covered the following:

* Added a custom endpoint for the Service Bus queue to your IoT hub.
* Created a message routing rule to direct messages that contain a temperature alert to the Service Bus queue.
* Configured a Logic App to monitor the Service Bus queue and place a new order to replace the damaged vaccine whenever a message is added to the queue. 
* Reviewed the Logic App run.
